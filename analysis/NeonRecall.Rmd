---
title: "Neon Recall"
author: "Ben Weinstein"
date: "4/20/2018"
output: 
  html_document:
    toc: true
    number_sections: true
editor_options: 
  chunk_output_type: console
---

```{r,warning=F,message=F}
library(tidyverse)
library(knitr)
library(maptools)
library(rgdal)
library(TreeSegmentation)
library(sp)
library(rgl)
library(lidR)
library(kableExtra)

knit_hooks$set(webgl = hook_webgl)
opts_chunk$set(warning=F,message=F)

#set color ramp for treeID
col = pastel.colors(200)

site="SJER"

#set data paths
path_to_tiles=paste("../data/NeonPlots/",site,"/Lidar/",sep="")

#set cores
cores<-2
#cores<-15
```

# Load in ground-truth
```{r,results='hide'}


```

```{r}
ptrees<-unique(trees$plotID)
for(x in ptrees){

}

```

# As a wrapper for one tile, multiple methods
```{r,eval=F}
results<-evaluate(ground_truth=itcs[[2]],algorithm = c("silva"),path_to_tiles=path_to_tiles,plot_results=T,basemap="../data/2015/Camera/")

ggplot(results,aes(y=IoU,x=Method)) + geom_boxplot() + theme_bw()
results %>% group_by(Method) %>% summarize(mean=mean(IoU),median=median(IoU))
```

# Parallel wrapper across all tiles

```{r,eval=T}
system.time(results_all<-evaluate_all(itcs=itcs,algorithm = c("silva"),path_to_tiles=path_to_tiles,cores=1,extra=F,plot_results = T,basemap="../data/2017/Camera/L3/"))

#plot results
ggplot(results_all,aes(y=IoU,x=Method)) + geom_boxplot() + theme_bw()

#Compute test statistics
test_statistic<-results_all %>% group_by(Method) %>% summarize(mean=mean(IoU),median=median(IoU)) %>% mutate(Date=format(Sys.time(), "%m/%d/%y %H:%M:%S"))
test_statistic
write.table(test_statistic,"Results/results.csv",append = T,col.names = F,sep=",",row.names = F)
```


